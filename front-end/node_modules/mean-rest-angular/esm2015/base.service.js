/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { throwError } from 'rxjs';
import { catchError, map } from 'rxjs/operators';
import { HttpHeaders, HttpParams } from '@angular/common/http';
export class ServiceError {
}
if (false) {
    /** @type {?} */
    ServiceError.prototype.status;
    /** @type {?} */
    ServiceError.prototype.clientErrorMsg;
    /** @type {?} */
    ServiceError.prototype.serverError;
}
export class BaseService {
    /**
     * @param {?} http
     * @param {?} serviceUrl
     */
    constructor(http, serviceUrl) {
        this.http = http;
        this.serviceUrl = serviceUrl;
        this.storage = {};
    }
    /**
     * @param {?} name
     * @return {?}
     */
    getFromStorage(name) {
        return this.storage[name];
    }
    /**
     * @param {?} name
     * @param {?} value
     * @return {?}
     */
    putToStorage(name, value) {
        this.storage[name] = value;
    }
    /**
     * @protected
     * @param {?} error
     * @return {?}
     */
    errorResponseHandler(error) {
        /** @type {?} */
        let err = new ServiceError();
        ;
        if (error.error instanceof ErrorEvent) {
            // A client-side or network error occurred. Handle it accordingly.
            err.status = 0;
            err.clientErrorMsg = error.error.message;
        }
        else {
            // The backend returned an unsuccessful response code.
            // The response body may contain clues as to what went wrong,
            err.status = error.status;
            err.serverError = error.error;
        }
        // return an observable with a user-facing error message
        return throwError(err);
    }
    /**
     * @protected
     * @param {?} detail
     * @return {?}
     */
    formatDetail(detail) {
        return detail;
    }
    /**
     * @protected
     * @param {?} list
     * @return {?}
     */
    formatList(list) {
        return list;
    }
    /**
     * @param {?} page
     * @param {?} per_page
     * @param {?} searchContext
     * @return {?}
     */
    getList(page, per_page, searchContext) {
        /** @type {?} */
        let httpOptions = {
            params: new HttpParams().set('__page', page.toString())
                .set('__per_page', per_page.toString()),
            headers: new HttpHeaders({ 'Accept': 'application/json' }),
        };
        if (!searchContext) {
            return this.http.get(this.serviceUrl, httpOptions)
                .pipe(map(this.formatList), catchError(this.errorResponseHandler));
        }
        httpOptions.params = httpOptions.params.set('action', "Search");
        return this.http.post(this.serviceUrl + "mddsaction/get", searchContext, httpOptions)
            .pipe(catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} page
     * @param {?} per_page
     * @return {?}
     */
    getListWithCondition(page, per_page) {
        /** @type {?} */
        let httpOptions = {
            params: new HttpParams().set('__page', page.toString())
                .set('__per_page', per_page.toString()),
            headers: new HttpHeaders({ 'Accept': 'application/json' }),
        };
        return this.http.get(this.serviceUrl, httpOptions)
            .pipe(map(this.formatList), catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} id
     * @param {?} action
     * @return {?}
     */
    getDetailForAction(id, action) {
        /** @type {?} */
        let httpOptions = {
            headers: new HttpHeaders({ 'Accept': 'application/json' }),
        };
        /** @type {?} */
        let serviceUrl = this.serviceUrl;
        if (action) {
            httpOptions['params'] = new HttpParams().set('action', action);
            if (action == "edit")
                action = "post";
            serviceUrl = serviceUrl + "mddsaction/" + action + "/";
        }
        return this.http.get(serviceUrl + id, httpOptions)
            .pipe(map(this.formatDetail), catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} id
     * @return {?}
     */
    getDetail(id) {
        return this.getDetailForAction(id, null);
    }
    /**
     * @param {?} id
     * @return {?}
     */
    deleteOne(id) {
        return this.http.delete(this.serviceUrl + id)
            .pipe(catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} ids
     * @return {?}
     */
    deleteManyByIds(ids) {
        /** @type {?} */
        let httpOptions = {
            headers: new HttpHeaders({ 'Content-Type': 'application/json' }),
            params: new HttpParams().set('action', "DeleteManyByIds"),
        };
        return this.http.post(this.serviceUrl + "mddsaction/delete", ids, httpOptions)
            .pipe(catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} item
     * @return {?}
     */
    createOne(item) {
        /** @type {?} */
        let httpOptions = {
            headers: new HttpHeaders({ 'Content-Type': 'application/json' })
        };
        return this.http.put(this.serviceUrl, item, httpOptions)
            .pipe(map(this.formatDetail), catchError(this.errorResponseHandler));
    }
    /**
     * @param {?} id
     * @param {?} item
     * @return {?}
     */
    updateOne(id, item) {
        /** @type {?} */
        let httpOptions = {
            headers: new HttpHeaders({ 'Content-Type': 'application/json' })
        };
        return this.http.post(this.serviceUrl + id, item, httpOptions)
            .pipe(catchError(this.errorResponseHandler));
    }
}
if (false) {
    /**
     * @type {?}
     * @protected
     */
    BaseService.prototype.storage;
    /**
     * @type {?}
     * @protected
     */
    BaseService.prototype.http;
    /**
     * @type {?}
     * @protected
     */
    BaseService.prototype.serviceUrl;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWVhbi1yZXN0LWFuZ3VsYXIvIiwic291cmNlcyI6WyJiYXNlLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYyxVQUFVLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDOUMsT0FBTyxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQWlCLE1BQU0sZ0JBQWdCLENBQUM7QUFDaEUsT0FBTyxFQUFjLFdBQVcsRUFBQyxVQUFVLEVBQXFCLE1BQU0sc0JBQXNCLENBQUM7QUFFN0YsTUFBTSxPQUFPLFlBQVk7Q0FJeEI7OztJQUhHLDhCQUFjOztJQUNkLHNDQUFzQjs7SUFDdEIsbUNBQWdCOztBQUdwQixNQUFNLE9BQU8sV0FBVzs7Ozs7SUFHcEIsWUFBc0IsSUFBZ0IsRUFBWSxVQUFrQjtRQUE5QyxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQVksZUFBVSxHQUFWLFVBQVUsQ0FBUTtRQUYxRCxZQUFPLEdBQU8sRUFBRSxDQUFDO0lBRTRDLENBQUM7Ozs7O0lBRWpFLGNBQWMsQ0FBQyxJQUFXO1FBQzdCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5QixDQUFDOzs7Ozs7SUFDTSxZQUFZLENBQUMsSUFBVyxFQUFFLEtBQVM7UUFDdEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLENBQUM7SUFDL0IsQ0FBQzs7Ozs7O0lBRVMsb0JBQW9CLENBQUMsS0FBd0I7O1lBQ2pELEdBQUcsR0FBZ0IsSUFBSSxZQUFZLEVBQUU7UUFBQyxDQUFDO1FBQzNDLElBQUksS0FBSyxDQUFDLEtBQUssWUFBWSxVQUFVLEVBQUU7WUFDbkMsa0VBQWtFO1lBQ2xFLEdBQUcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ2YsR0FBRyxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQTtTQUMzQzthQUFNO1lB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QUksQ0FBQyxHQUFHLENBQU0sSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDO2FBQ3hELElBQUksQ0FDRCxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxFQUN0QixVQUFVLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQ3hDLENBQUM7SUFDVixDQUFDOzs7Ozs7SUFDRCxTQUFTLENBQUMsRUFBUyxFQUFFLElBQVE7O1lBQ3JCLFdBQVcsR0FBRztZQUNkLE9BQU8sRUFBRSxJQUFJLFdBQVcsQ0FBQyxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDO1NBQ25FO1FBQ0QsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBTSxJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsV0FBVyxDQUFDO2FBQzlELElBQUksQ0FDRCxVQUFVLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQ3hDLENBQUM7SUFDVixDQUFDO0NBQ0o7Ozs7OztJQTlIRyw4QkFBMkI7Ozs7O0lBRWYsMkJBQTBCOzs7OztJQUFFLGlDQUE0QiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIHRocm93RXJyb3IgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGNhdGNoRXJyb3IsIG1hcCwgZmlsdGVyLCByZXRyeSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBIZWFkZXJzLEh0dHBQYXJhbXMsIEh0dHBFcnJvclJlc3BvbnNlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuXG5leHBvcnQgY2xhc3MgU2VydmljZUVycm9yIHtcbiAgICBzdGF0dXM6bnVtYmVyO1xuICAgIGNsaWVudEVycm9yTXNnOnN0cmluZztcbiAgICBzZXJ2ZXJFcnJvcjphbnk7XG59XG5cbmV4cG9ydCBjbGFzcyBCYXNlU2VydmljZSB7XG4gICAgcHJvdGVjdGVkIHN0b3JhZ2U6YW55ID0ge307XG5cbiAgICBjb25zdHJ1Y3Rvcihwcm90ZWN0ZWQgaHR0cDogSHR0cENsaWVudCwgcHJvdGVjdGVkIHNlcnZpY2VVcmw6IHN0cmluZykge31cbiAgICBcbiAgICBwdWJsaWMgZ2V0RnJvbVN0b3JhZ2UobmFtZTpzdHJpbmcpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmFnZVtuYW1lXTtcbiAgICB9XG4gICAgcHVibGljIHB1dFRvU3RvcmFnZShuYW1lOnN0cmluZywgdmFsdWU6YW55KSB7XG4gICAgICAgIHRoaXMuc3RvcmFnZVtuYW1lXSA9IHZhbHVlO1xuICAgIH1cbiAgICBcbiAgICBwcm90ZWN0ZWQgZXJyb3JSZXNwb25zZUhhbmRsZXIoZXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlKSB7XG4gICAgICBsZXQgZXJyOlNlcnZpY2VFcnJvciA9IG5ldyBTZXJ2aWNlRXJyb3IoKTs7XG4gICAgICBpZiAoZXJyb3IuZXJyb3IgaW5zdGFuY2VvZiBFcnJvckV2ZW50KSB7XG4gICAgICAgICAgLy8gQSBjbGllbnQtc2lkZSBvciBuZXR3b3JrIGVycm9yIG9jY3VycmVkLiBIYW5kbGUgaXQgYWNjb3JkaW5nbHkuXG4gICAgICAgICAgZXJyLnN0YXR1cyA9IDA7XG4gICAgICAgICAgZXJyLmNsaWVudEVycm9yTXNnID0gZXJyb3IuZXJyb3IubWVzc2FnZVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBUaGUgYmFja2VuZCByZXR1cm5lZCBhbiB1bnN1Y2Nlc3NmdWwgcmVzcG9uc2UgY29kZS5cbiAgICAgICAgICAvLyBUaGUgcmVzcG9uc2UgYm9keSBtYXkgY29udGFpbiBjbHVlcyBhcyB0byB3aGF0IHdlbnQgd3JvbmcsXG4gICAgICAgICAgZXJyLnN0YXR1cyA9IGVycm9yLnN0YXR1cztcbiAgICAgICAgICBlcnIuc2VydmVyRXJyb3IgPSBlcnJvci5lcnJvcjtcbiAgICAgIH1cbiAgICAgIC8vIHJldHVybiBhbiBvYnNlcnZhYmxlIHdpdGggYSB1c2VyLWZhY2luZyBlcnJvciBtZXNzYWdlXG4gICAgICByZXR1cm4gdGhyb3dFcnJvcihcbiAgICAgICAgZXJyXG4gICAgICApO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBmb3JtYXREZXRhaWwoZGV0YWlsOmFueSk6IGFueSB7XG4gICAgICAgIHJldHVybiBkZXRhaWw7XG4gICAgfVxuICAgIFxuICAgIHByb3RlY3RlZCBmb3JtYXRMaXN0KGxpc3Q6YW55KTogYW55IHtcbiAgICAgICAgcmV0dXJuIGxpc3Q7XG4gICAgfVxuXG4gICAgZ2V0TGlzdChwYWdlOm51bWJlciwgcGVyX3BhZ2U6bnVtYmVyLCBzZWFyY2hDb250ZXh0OmFueSkge1xuICAgICAgICBsZXQgaHR0cE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBwYXJhbXM6IG5ldyBIdHRwUGFyYW1zKCkuc2V0KCdfX3BhZ2UnLCBwYWdlLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuc2V0KCdfX3Blcl9wYWdlJywgcGVyX3BhZ2UudG9TdHJpbmcoKSksXG4gICAgICAgICAgICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoeyAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pLFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgaWYgKCFzZWFyY2hDb250ZXh0KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5odHRwLmdldDxhbnk+KHRoaXMuc2VydmljZVVybCwgaHR0cE9wdGlvbnMpXG4gICAgICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgIG1hcCh0aGlzLmZvcm1hdExpc3QpLFxuICAgICAgICAgICAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuZXJyb3JSZXNwb25zZUhhbmRsZXIpXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBodHRwT3B0aW9ucy5wYXJhbXMgPSBodHRwT3B0aW9ucy5wYXJhbXMuc2V0KCdhY3Rpb24nLCBcIlNlYXJjaFwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PGFueT4odGhpcy5zZXJ2aWNlVXJsKyBcIm1kZHNhY3Rpb24vZ2V0XCIsIHNlYXJjaENvbnRleHQsIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmVycm9yUmVzcG9uc2VIYW5kbGVyKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXRMaXN0V2l0aENvbmRpdGlvbihwYWdlOm51bWJlciwgcGVyX3BhZ2U6bnVtYmVyKSB7XG4gICAgICAgIGxldCBodHRwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHBhcmFtczogbmV3IEh0dHBQYXJhbXMoKS5zZXQoJ19fcGFnZScsIHBhZ2UudG9TdHJpbmcoKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zZXQoJ19fcGVyX3BhZ2UnLCBwZXJfcGFnZS50b1N0cmluZygpKSxcbiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7ICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicgfSksXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8YW55Pih0aGlzLnNlcnZpY2VVcmwsIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMuZm9ybWF0TGlzdCksXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmVycm9yUmVzcG9uc2VIYW5kbGVyKVxuICAgICAgICAgICAgKTtcbiAgICB9XG5cbiAgICBnZXREZXRhaWxGb3JBY3Rpb24oaWQ6IHN0cmluZywgYWN0aW9uOiBzdHJpbmcpIHtcbiAgICAgICAgbGV0IGh0dHBPcHRpb25zID0ge1xuICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7ICdBY2NlcHQnOiAnYXBwbGljYXRpb24vanNvbicgfSksXG4gICAgICAgIH07XG4gICAgICAgIGxldCBzZXJ2aWNlVXJsID0gdGhpcy5zZXJ2aWNlVXJsXG4gICAgICAgIGlmIChhY3Rpb24pIHtcbiAgICAgICAgICBodHRwT3B0aW9uc1sncGFyYW1zJ10gPSBuZXcgSHR0cFBhcmFtcygpLnNldCgnYWN0aW9uJywgYWN0aW9uKTtcbiAgICAgICAgICBpZiAoYWN0aW9uID09IFwiZWRpdFwiKSBhY3Rpb24gPSBcInBvc3RcIlxuICAgICAgICAgIHNlcnZpY2VVcmwgPSBzZXJ2aWNlVXJsICsgXCJtZGRzYWN0aW9uL1wiICsgYWN0aW9uICsgXCIvXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8YW55PihzZXJ2aWNlVXJsICsgaWQsIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMuZm9ybWF0RGV0YWlsKSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuZXJyb3JSZXNwb25zZUhhbmRsZXIpXG4gICAgICAgICAgICApO1xuICAgIH1cbiAgICBnZXREZXRhaWwoaWQ6IHN0cmluZykge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXREZXRhaWxGb3JBY3Rpb24oaWQsIG51bGwpO1xuICAgIH1cbiAgICBkZWxldGVPbmUoaWQ6c3RyaW5nKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlPGFueT4odGhpcy5zZXJ2aWNlVXJsICsgaWQpXG4gICAgICAgICAgICAucGlwZShcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuZXJyb3JSZXNwb25zZUhhbmRsZXIpXG4gICAgICAgICAgICApO1xuICAgIH1cbiAgICBkZWxldGVNYW55QnlJZHMoaWRzOnN0cmluZ1tdKSB7XG4gICAgICAgIGxldCBodHRwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSksXG4gICAgICAgICAgICBwYXJhbXM6IG5ldyBIdHRwUGFyYW1zKCkuc2V0KCdhY3Rpb24nLCBcIkRlbGV0ZU1hbnlCeUlkc1wiKSxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0PGFueT4odGhpcy5zZXJ2aWNlVXJsICsgXCJtZGRzYWN0aW9uL2RlbGV0ZVwiLCBpZHMsIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgY2F0Y2hFcnJvcih0aGlzLmVycm9yUmVzcG9uc2VIYW5kbGVyKVxuICAgICAgICAgICAgKTtcbiAgICB9XG4gICAgY3JlYXRlT25lKGl0ZW06YW55KSB7XG4gICAgICAgIGxldCBodHRwT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIGhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycyh7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSlcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQ8YW55Pih0aGlzLnNlcnZpY2VVcmwsIGl0ZW0sIGh0dHBPcHRpb25zKVxuICAgICAgICAgICAgLnBpcGUoXG4gICAgICAgICAgICAgICAgbWFwKHRoaXMuZm9ybWF0RGV0YWlsKSxcbiAgICAgICAgICAgICAgICBjYXRjaEVycm9yKHRoaXMuZXJyb3JSZXNwb25zZUhhbmRsZXIpXG4gICAgICAgICAgICApO1xuICAgIH1cbiAgICB1cGRhdGVPbmUoaWQ6c3RyaW5nLCBpdGVtOmFueSkge1xuICAgICAgICBsZXQgaHR0cE9wdGlvbnMgPSB7XG4gICAgICAgICAgICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0pXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxhbnk+KHRoaXMuc2VydmljZVVybCArIGlkLCBpdGVtLCBodHRwT3B0aW9ucylcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICAgIGNhdGNoRXJyb3IodGhpcy5lcnJvclJlc3BvbnNlSGFuZGxlcilcbiAgICAgICAgICAgICk7XG4gICAgfVxufVxuIl19